<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Crop Recommendation</title>
</head>
<body>
  <h1>Crop Recommendation System</h1>

  <form id="cropForm">
    <label>Soil pH: <input type="number" step="0.1" name="soil_pH" required></label><br>
    <label>Microbial Activity (0–5): <input type="number" step="0.1" name="microbes" required></label><br>
    <label>Phosphates (ppm): <input type="number" name="phosphates" required></label><br>
    <label>Potassium (ppm): <input type="number" name="potassium" required></label><br>
    <label>Nitrates (ppm): <input type="number" name="nitrates" required></label><br>
    <label>Aeration/Compaction (0–5): <input type="number" step="0.1" name="aeration_compaction" required></label><br>
    <button type="submit">Get Recommendation</button>
  </form>

  <h2 id="result"></h2>

  <script>
    const cropData = [
      { crop: "Lettuce", soil_pH: 6.0, microbes: 4.5, phosphates: 20, potassium: 150, nitrates: 10, aeration_compaction: 3 },
      { crop: "Tomato", soil_pH: 6.5, microbes: 3.5, phosphates: 40, potassium: 180, nitrates: 20, aeration_compaction: 4 },
      { crop: "Beans", soil_pH: 6.8, microbes: 4.0, phosphates: 35, potassium: 160, nitrates: 15, aeration_compaction: 3 },
      { crop: "Spinach", soil_pH: 6.2, microbes: 4.7, phosphates: 25, potassium: 140, nitrates: 12, aeration_compaction: 5 },
      { crop: "Kale", soil_pH: 6.3, microbes: 3.8, phosphates: 30, potassium: 170, nitrates: 18, aeration_compaction: 4 }
    ];

    const weights = {
      soil_pH: 0.16666,
      microbes: 0.166666,
      phosphates: 0.16666,
      potassium: 0.16666,
      nitrates: 0.16666,
      aeration_compaction: 0.16666
    };

    const features = Object.keys(weights);

    // Normalize a dataset
    function normalizeData(data, featureList) {
      const mins = {};
      const maxs = {};
      featureList.forEach(f => {
        mins[f] = Math.min(...data.map(row => row[f]));
        maxs[f] = Math.max(...data.map(row => row[f]));
      });

      return data.map(row => {
        const norm = {};
        featureList.forEach(f => {
          norm[f] = (row[f] - mins[f]) / (maxs[f] - mins[f]);
        });
        norm.crop = row.crop;
        return norm;
      });
    }

    const normalizedData = normalizeData(cropData, features);

    document.getElementById("cropForm").addEventListener("submit", function (e) {
      e.preventDefault();

      const formData = new FormData(e.target);
      const userInput = {};
      features.forEach(f => {
        userInput[f] = parseFloat(formData.get(f));
      });

      // Normalize user input using training data mins/maxs
      const mins = {}, maxs = {};
      features.forEach(f => {
        mins[f] = Math.min(...cropData.map(row => row[f]));
        maxs[f] = Math.max(...cropData.map(row => row[f]));
      });

      const normalizedUser = {};
      features.forEach(f => {
        normalizedUser[f] = (userInput[f] - mins[f]) / (maxs[f] - mins[f]);
      });

      // Apply weights and compute distance to each crop
      let bestCrop = "";
      let bestDistance = Infinity;

      normalizedData.forEach(row => {
        let dist = 0;
        features.forEach(f => {
          const diff = (normalizedUser[f] - row[f]) * weights[f];
          dist += diff * diff;
        });
        if (dist < bestDistance) {
          bestDistance = dist;
          bestCrop = row.crop;
        }
      });

      document.getElementById("result").textContent = `Recommended Crop: ${bestCrop}`;
    });
  </script>
</body>
</html>
